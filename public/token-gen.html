<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clerk Token Generator</title>
    <script
      async
      crossorigin="anonymous"
      data-clerk-publishable-key="pk_test_Z2FtZS1saXphcmQtNzcuY2xlcmsuYWNjb3VudHMuZGV2JA"
      src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
      type="text/javascript"
    ></script>
</head>
<body style="font-family: system-ui, sans-serif; padding: 2rem; max-width: 600px; margin: 0 auto;">
    <h1>Clerk Token Generator</h1>
    <p>Use this page to sign in and generate a JWT token for Postman testing.</p>

    <div id="sign-in"></div>
    <div id="user-button"></div>
    
    <div id="token-display" style="display: none; margin-top: 2rem; padding: 1rem; background: #f4f4f5; border-radius: 8px; border: 1px solid #e4e4e7;">
        <h3 style="margin-top: 0;">Your Backend Token</h3>
        <p style="font-size: 0.9rem; color: #666;">Include this in Postman header: <code>Authorization: Bearer &lt;token&gt;</code></p>
        <textarea id="token-area" rows="10" style="width: 100%; padding: 0.5rem; font-family: monospace; margin-bottom: 1rem;" readonly></textarea>
        <button onclick="copyToken()" style="padding: 0.5rem 1rem; cursor: pointer; background: #000; color: #fff; border: none; border-radius: 4px;">Copy Token</button>
        <button onclick="refreshToken()" style="padding: 0.5rem 1rem; cursor: pointer; background: #fff; color: #000; border: 1px solid #000; border-radius: 4px; margin-left: 0.5rem;">Refresh Token</button>
    </div>

    <script>
        const pubKey = 'pk_test_Z2FtZS1saXphcmQtNzcuY2xlcmsuYWNjb3VudHMuZGV2JA'; // Hardcoded from your .env for convenience

        window.addEventListener('load', async function () {
            await Clerk.load();

            if (Clerk.user) {
                document.getElementById('user-button').mount(document.getElementById('user-button'));
                showToken();
            } else {
                document.getElementById('sign-in').mount(document.getElementById('sign-in'));
            }
        });

        async function showToken() {
            if (!Clerk.user) return;
            
            // Get the token (valid for 60 seconds by default, but we can use it for requests)
            const token = await Clerk.session.getToken();
            
            document.getElementById('token-display').style.display = 'block';
            document.getElementById('token-area').value = token;
            document.getElementById('sign-in').style.display = 'none';
        }

        function copyToken() {
            const tokenArea = document.getElementById('token-area');
            tokenArea.select();
            document.execCommand('copy');
            alert('Token copied to clipboard!');
        }

        async function refreshToken() {
            if (!Clerk.user) return;
            const token = await Clerk.session.getToken({ skipCache: true });
            document.getElementById('token-area').value = token;
        }
    </script>
</body>
</html>
